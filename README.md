# Terraform-модуль для инфраструктуры в Yandex Cloud

## Краткое описание

**Модуль автоматизирует создание базовой облачной инфраструктуры в Yandex Cloud.**  
После запуска вы получаете полностью готовую к работе среду, включающую сети, виртуальные машины с дисками, YDB Serverless и Object Storage с необходимыми правами доступа.

---

## Summary: Что создаёт модуль

- **Object Storage:**
    - Создаёт уникальный бакет в Yandex Object Storage.
    - Автоматически генерирует сервисный аккаунт с ключами доступа.
    - Назначает необходимые права для работы с бакетом.

- **Виртуальные машины (VM):**
    - В каждой из трёх зон (`ru-central1-a`, `ru-central1-b`, `ru-central1-d`) создаётся по одной виртуальной машине.
    - Для каждой VM создаётся загрузочный диск и два дополнительных диска (secondary).
    - Для каждого загрузочного диска делается снимок (snapshot) для резервного копирования.

- **YDB Serverless:**
    - Разворачивается экземпляр Yandex Database (serverless).

- **Сеть:**
    - Создаётся виртуальная сеть (VPC).
    - Для каждой зоны создаётся отдельная публичная подсеть.
    - Настраивается таблица маршрутизации для выхода в интернет.

- **Другое:**
    - Генерация случайных строк для именования ресурсов.
    - Настраиваются паузы и передачи данных между ресурсами для корректной инициализации.
    - Выдаётся необходимый доступ сервисным аккаунтам к папке в Yandex Cloud.

---

## Необходимые провайдеры

| Name     | Version     |
|----------|-------------|
| aws      | ~> 5.70.0   |
| yandex   | >= 0.35.0   |

## Используемые провайдеры

| Name      | Version  |
|-----------|----------|
| random    | 3.7.2    |
| terraform | n/a      |
| time      | 0.13.1   |
| yandex    | 0.141.0  |

## Используемые модули

| Name   | Source  | Version |
|--------|---------|---------|
| net    | github.com/terraform-yc-modules/terraform-yc-vpc.git | 19a9893f25b2536cea3c9c15c180c905ea37bf9c |
| s3     | github.com/terraform-yc-modules/terraform-yc-s3.git  | 9fc2f832875aefb6051a2aa47b5ecc9a7ea8fde5 |

## Основные ресурсы

- **Yandex Object Storage Bucket** — бакет для хранения данных с отдельным сервисным аккаунтом и ключами.
- **Виртуальные машины** — три VM, по одной в каждой зоне доступности, каждая с загрузочным и дополнительными дисками.
- **Снимки дисков** — резервное копирование загрузочных дисков.
- **YDB Serverless** — управляемая база данных для приложений.
- **Виртуальная сеть и подсети** — общая сеть и три публичные подсети.
- **Права доступа** — сервисные аккаунты и роли для работы с бакетом.
- **Технические ресурсы** — генерация уникальных имён, паузы на развёртывание, и т.п.

---

## Входные параметры

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| **boot_disk_name** | Имя загрузочного диска (опционально) | string | null | Нет |
| **bucket_name** | Имя bucket в Object Storage (опционально) | string | null | Нет |
| **bucket_sa_name** | Имя сервисного аккаунта для bucket (опционально) | string | null | Нет |
| **folder_id** | ID папки в Yandex Cloud, где создаются ресурсы | string | — | **Да** |
| **image_id** | ID образа для загрузочного диска. По умолчанию Ubuntu 22.04 LTS | string | "fd833v6c5tb0udvk4jo6" | Нет |
| **instance_resources** | Конфигурация VM: тип, CPU, память, диск | object | — | **Да** |
| **linux_vm_name** | Имя для виртуальной машины (опционально) | string | null | Нет |
| **name_prefix** | Префикс для имён ресурсов | string | "project" | Нет |
| **secondary_disks** | Конфиг для дополнительных дисков | object | см. ниже | Нет |
| **subnets** | Карта зон и их CIDR-блоков | map(list(string)) | см. ниже | Нет |
| **vpc_network_name** | Имя VPC-сети (опционально) | string | null | Нет |
| **ydb_serverless_name** | Имя YDB serverless (опционально) | string | null | Нет |
| **zones** | Список зон для размещения ресурсов | set(string) | см. ниже | Нет |

<details>
<summary>Пример <code>instance_resources</code>:</summary>

```hcl
instance_resources = {
  platform_id = "standard-v3"
  cores       = 2
  memory      = 4
  disk = {
    disk_type = "network-ssd"
    disk_size = 20
  }
}
